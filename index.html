<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Firefox Accounts: Under The Hood</title>
  <meta name="author" content="Brian Warner">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="css/reveal.min.css">
  <link rel="stylesheet" href="css/theme/sky.css" id="theme">
  <!-- For syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">
  <!-- If the query includes 'print-pdf', use the PDF print sheet -->
  <script>
   document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
  </script>
  <!--[if lt IE 9]>
   <script src="lib/js/html5shiv.js"></script>
  <![endif]-->
 <style>
  .reveal h3 { margin-bottom: 50px; }
  .reveal h3 {word-wrap: normal; -webkit-hyphens: manual; -moz-hyphens: manual; hyphens: manual}
  .reveal img.noborder { background: none; box-shadow: none }
  .reveal code {font-size: 70%}
 </style>
</head>

<body>
  <div class="reveal">
  <div class="slides">

    <section>
      <h2>Firefox Accounts and FF Sync</h2>
      <br>
      <br>
      <br>
      <br>
      <h4>Brian Warner</h4>
      <h4><tt>warner@mozilla.com</tt></h4>
      <br>
    </section>

    <section>
      <h3>Outline</h3>
      <ul>
        <li>What are Firefox Accounts?</li>
        <li>What is FxA used for?</li>
        <li>FxA + Firefox Sync</li>
        <li>FxA Security Properties</li>
      </ul>
    </section>

    <section>
      <h3>What is a Firefox Account?</h3>
      <ul>
        <li>Like a Google/Facebook account</li>
        <ul>
          <li>But for Mozilla services</li>
        </ul>
        <li>Useable in any browser</li>
        <ul>
          <li>but some features will only be used by Firefox at first</li>
        </ul>
    </section>

    <section>
      <h3>What is FxA used for?</h3>
      <ul>
        <li>Firefox Sync (as of FF29)</li>
        <li>Marketplace (soon)</li>
        <li>Where's My Fox (soon)</li>
        <li>other upcoming Mozilla services</li>
      </ul>
    </section>

    <section>
      <h3>What does a Firefox Account get you?</h3>
      <ul>
        <li>Input: email address + password</li>
        <li>Output: encryption keys + BrowserID assertions</li>
        <ul>
          <li>kA (recoverable by email)</li>
          <li>kB (protected by password)</li>
          <li>signed BrowserID certificate</li>
        </ul>
      </ul>
      <br>
      <br>
      <img src="images/FxA-overview.png">
    </section>

    <section>
      <h3>How is FxA used by Sync?</h3>
      <ul>
        <li>assertion controls access</li>
        <li>kB key encrypts data</li>
        <li>.. but first, we review old Sync</li>
      </ul>
      <aside class="notes">first, we need to talk about old sync</aside>
    </section>

    <section>
      <h3>Old Sync</h3>
      <ul>
        <li>Introduced in Firefox 4.0 (March 2011)</li>
        <li>Goals:</li>
        <ul>
          <li>secure sync of two or more devices</li>
        </ul>
      </ul>
      <img src="images/pairing-codes.png">
    </section>

    <section> <!-- old sync security vertical column -->
      <section>
        <h3>Old Sync Security</h3>
        <ul>
          <li>random encryption key generated by first device</li>
        </ul>
        <img src="images/old-sync-1.png">
      </section>

      <section>
        <h3>Old Sync Security</h3>
        <ul>
          <li>pairing transfers the key to second device</li>
        </ul>
        <img src="images/old-sync-2.png">
      </section>

      <section>
        <h3>Old Sync Security</h3>
        <ul>
          <li>pairing transfers the key to second device</li>
        </ul>
        <img src="images/old-sync-3.png">
      </section>

      <section>
        <h3>Old Sync Security</h3>
        <ul>
          <li>pairing transfers the key to second device</li>
        </ul>
        <img src="images/old-sync-4.png">
      </section>

      <section>
        <h3>Old Sync Security</h3>
        <ul>
          <li>single-use pairing code is forgotten</li>
        </ul>
        <img src="images/old-sync-5.png">
      </section>

      <section>
        <h3>Old Sync Security</h3>
        <ul>
          <li>second device uses shared key to decrypt data</li>
        </ul>
        <img src="images/old-sync-6.png">
      </section>

    </section>

    <section>
      <h3>Old Sync Problems</h3>
      <ul>
        <li>not useful for single device, surprising setup process</li>
        <li>too many unhappy users, not enough happy users</li>
      </ul>
        <img src="images/pairing-wtf.png">
    </section>

    <section>
      <h3>New Sync</h3>
      <ul>
        <li>coming in Firefox 29 (April 2014)</li>
        <li>Goals:</li>
        <ul>
          <li>secure sync one or more devices with cloud</li>
          <li>conventional password-based signin</li>
        </ul>
        <img src="images/new-sync-boxes.png">
      </ul>
    </section>

    <section>
      <h3>New Sync Security</h3>
      <ul>
        <li>random encryption key generated by first device</li>
        <li>wrapped by password, then stored on server</li>
        <li>retrieved by second device, unwrapped</li>
        <li><b>still end-to-end encryption</b></li>
        <ul>
          <li>but based on password, not pairing</li>
        </ul>
      </ul>
    </section>

    <section> <!-- new sync security vertical column -->
      <section>
        <h3>New Sync Security</h3>
        <ul>
          <li>random encryption key generated by first device</li>
        </ul>
        <img src="images/new-sync-1.png">
      </section>

      <section>
        <h3>New Sync Security</h3>
        <ul>
          <li>key wrapped by user password, stored on auth server</li>
        </ul>
        <img src="images/new-sync-2.png">
      </section>

      <section>
        <h3>New Sync Security</h3>
        <ul>
          <li>password forgotten</li>
        </ul>
        <img src="images/new-sync-3.png">
      </section>

      <section>
        <h3>New Sync Security</h3>
        <ul>
          <li>second device starts with password</li>
        </ul>
        <img src="images/new-sync-4.png">
      </section>

      <section>
        <h3>New Sync Security</h3>
        <ul>
          <li>fetches from auth server, unwraps key</li>
        </ul>
        <img src="images/new-sync-5.png">
      </section>

      <section>
        <h3>New Sync Security</h3>
        <ul>
          <li>second device uses shared key to decrypt data</li>
        </ul>
        <img src="images/new-sync-6.png">
      </section>

    </section>

    <section>
      <h3>kA vs kB</h3>
      <ul>
        <li>kA:</li>
        <ul>
          <li>known by fxa-auth-server</li>
          <li>immutable: persistent through account reset</li>
          <li>user-recoverable by answering email challenge</li>
        </ul>
        <li>kB:</li>
        <ul>
          <li>protected by user password</li>
          <li>erased/reset upon account reset</li>
          <li><b>not</b> recoverable if password is forgotten</li>
          <li><b>used for Sync data</b></li>
        </ul>
        <li>Applications use derivatives, not raw kA/kB</li>
      </ul>
    </section>

    <section>
      <h3>Protecting kB</h3>
      <ul>
        <li>server does not learn password or kB</li>
      </ul>
      <img src="images/onepw-overview.png">
    </section>

    <section>
      <h3>References</h3>
      <ul>
        <li>Project Page:</li>
        <li><a href="https://wiki.mozilla.org/Identity/FirefoxAccount"><code>https://wiki.mozilla.org/Identity/FirefoxAccount</code></a></li>
        <li>Protocol Diagrams:</li>
        <li><a href="https://github.com/mozilla/fxa-auth-server/wiki/onepw-protocol"><code>https://github.com/mozilla/fxa-auth-server/wiki/onepw-protocol</code></a></li>
        <li>Login Server:</li>
        <li><a href="https://github.com/mozilla/fxa-auth-server"><code>https://github.com/mozilla/fxa-auth-server</code></a></li>
      </ul>
    </section>

    <section>
      <h3>Questions?</h3>
      <ul>
        <li>Thanks!</li>
      </ul>
    </section>

    
  </div>
</div>


<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
  controls: true,
  progress: true,
  history: true,
  center: false,
  slideNumber: true,
  // default size is width:960, height:700
  //width: 1024, height: 768,
  // width, height, margin, minScale, maxScale
  //margin: 0.01,
  maxScale: 4.0,

  theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
  transition: Reveal.getQueryHash().transition || 'fade', // default/cube/page/concave/zoom/linear/fade/none

  // Parallax scrolling
  // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
  // parallaxBackgroundSize: '2100px 900px',

  // Optional libraries used to extend on reveal.js
  dependencies: [
   { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
   { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
   { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
   { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
   { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
   { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});
</script>

</body> </html>
